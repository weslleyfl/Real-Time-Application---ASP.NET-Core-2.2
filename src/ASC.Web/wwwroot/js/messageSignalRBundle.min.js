$(document).ready(function(){function i(n){var t=$(".divNotification").html();$(".divNotification").html(t.replace("{$}",n.status));$(".tap-target").removeClass("hide");$(".tap-target").tapTarget("open");setTimeout(function(){$(".tap-target").tapTarget("close");$(".tap-target").addClass("hide")},5e3)}function r(n){t++;var i=$(".promotionTemplate").clone().html();i=i.replace("{Header}",n.header);i=i.replace("{Content}",n.content);i=i.replace("{Style}",n.partitionKey==="Discount"?"light-green darken-2":"light-blue darken-2");$(".divPromotions").prepend(i);$("#ancrPromotions .badge").remove();$("#ancrPromotions").prepend('<span class="new badge">'+t+"<\/span>")}var n=(new signalR.HubConnectionBuilder).withUrl("/serviceMessagesHub").build(),t;n.on("publishNotification",function(n){i(n)});n.on("publishPromotion",function(n){r(n)});n.start().catch(function(n){return console.error(n.toString())});t=0});$(document).ready(function(){function t(){$(".messages").animate({scrollTop:1e4},"normal")}function u(n){n.length===0&&$(".noMessages").removeClass("hide");$.each(n,function(t){var r=n[t];i(r)});t()}function f(n){n.PartitionKey===$("#ServiceRequest_RowKey").val()&&(n!==null&&$(".noMessages").addClass("hide"),i(n),t())}function i(n){var t=$("#hdnCustomerEmail").val()===n.FromEmail?"blue lighten-1":"teal lighten- 2";$("#messagesList").append('<li class="card-panel '+t+' white-text padding-10px"><div class="col s12 padding-0px"><div class="col s8 padding-0px"><b>'+n.FromDisplayName+'<\/b><\/div><div class="col s4 padding-0px font-size-12px right-align">'+new Date(n.MessageDate).toLocaleString()+"<\/div><\/div><br>"+n.Message+"<\/li>")}function e(n){$('div.chip img[data-id="isAd"]').attr("src",n.isAd?"/images/green_dot.png":"/images/red_dot.png");$('div.chip img[data-id="isCu"]').attr("src",n.isCu?"/images/green_dot.png":"/images/red_dot.png");$('div.chip img[data-id="isSe"]').attr("src",n.isSe?"/images/green_dot.png":"/images/red_dot.png")}var n=(new signalR.HubConnectionBuilder).withUrl("/serviceMessagesHub").build(),r=$("input[type=hidden][name=__RequestVerificationToken]",document).val();$.ajaxSetup({cache:!1,headers:{RequestVerificationToken:r,ServiceRequestId:$("#ServiceRequest_RowKey").val()}});$.get("/ServiceRequests/ServiceRequest/ServiceRequestMessages?serviceRequestId="+$("#ServiceRequest_RowKey").val(),function(n){u(n)});n.on("publishMessage",function(n){var t={};t.FromEmail=n.fromEmail;t.PartitionKey=n.partitionKey;t.MessageDate=n.messageDate;t.Message=n.message;t.FromDisplayName=n.fromDisplayName;t.CreatedDate=n.createdDate;t.IsDeleted=n.isDeleted;t.RowKey=n.rowKey;t.Timestamp=n.timestamp;t.UpdatedDate=n.updatedDate;f(t)});n.on("online",function(n){e(n)});n.start().catch(function(n){return console.error(n.tostring())});$(window).unload(function(){$.get("/ServiceRequests/ServiceRequest/MarkOfflineUser",function(){})});$("#txtMessage").keypress(function(n){var r=n.which,i;r===13&&(i={},i.Message=$("#txtMessage").val(),i.PartitionKey=$("#ServiceRequest_RowKey").val(),$.post("/ServiceRequests/ServiceRequest/CreateServiceRequestMessage",{menssagem:i},function(n){n&&($(".noMessages").addClass("hide"),$("#txtMessage").val(""))}),t())})});